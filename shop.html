        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Game Store</title>
            <script src="https://cdn.tailwindcss.com"></script>
            <link rel="preconnect" href="https://fonts.googleapis.com">
            <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
            <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
            <style>
                body { font-family: 'Inter', sans-serif; }
                .item-card { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
                .item-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
                #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.8); color: #333; display: flex; align-items: center; justify-content: center; z-index: 9999; font-size: 1.2em; backdrop-filter: blur(5px); }
            </style>
        </head>
        <body class="bg-gray-100">
            <div class="container mx-auto px-4 py-8 max-w-4xl">
                <header class="text-center mb-12">
                    <h1 class="text-4xl font-bold text-gray-800">Game Store</h1>
                    <p class="text-gray-600 mt-2">Select an item to purchase</p>
                </header>
                <main>
                    <h2 class="text-2xl font-semibold text-gray-700 mb-6">Coin Packs</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">

                        <div class="item-card bg-white rounded-lg shadow-md overflow-hidden p-5 flex flex-col">
                            <img src="https://placehold.co/300x200/FBBF24/ffffff?text=100+Coins" alt="Small Coin Pack" class="w-full h-40 object-cover rounded-md mb-4" onerror="this.onerror=null; this.src='https://placehold.co/300x200/cccccc/ffffff?text=Image+Error';">
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">100 Coin Pack</h3>
                            <p class="text-gray-600 text-sm mb-4 flex-grow">Get 100 shiny coins!</p>
                            <p class="text-lg font-bold text-indigo-600 mb-4">₱50.00</p> <button onclick="handlePurchase('coin_pack_100', '50.00', 'PHP')" class="mt-auto w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out">
                                Buy Now
                            </button>
                        </div>

                        <div class="item-card bg-white rounded-lg shadow-md overflow-hidden p-5 flex flex-col">
                             <img src="https://placehold.co/300x200/60A5FA/ffffff?text=550+Coins" alt="Medium Coin Pack" class="w-full h-40 object-cover rounded-md mb-4" onerror="this.onerror=null; this.src='https://placehold.co/300x200/cccccc/ffffff?text=Image+Error';">
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">Medium Coin Pack</h3>
                            <p class="text-gray-600 text-sm mb-4 flex-grow">Get 550 coins - great value!</p>
                            <p class="text-lg font-bold text-indigo-600 mb-4">₱250.00</p> <button onclick="handlePurchase('coin_pack_550', '250.00', 'PHP')" class="mt-auto w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out">
                                Buy Now
                            </button>
                        </div>

                        <div class="item-card bg-white rounded-lg shadow-md overflow-hidden p-5 flex flex-col">
                             <img src="https://placehold.co/300x200/34D399/ffffff?text=1200+Coins" alt="Large Coin Pack" class="w-full h-40 object-cover rounded-md mb-4" onerror="this.onerror=null; this.src='https://placehold.co/300x200/cccccc/ffffff?text=Image+Error';">
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">Large Coin Pack</h3>
                            <p class="text-gray-600 text-sm mb-4 flex-grow">Get 1200 coins!</p>
                            <p class="text-lg font-bold text-indigo-600 mb-4">₱500.00</p> <button onclick="handlePurchase('coin_pack_1200', '500.00', 'PHP')" class="mt-auto w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out">
                                Buy Now
                            </button>
                        </div>
                    </div>
                </main>
                <footer class="text-center mt-12 py-4 border-t border-gray-300">
                    <p class="text-gray-500 text-sm">&copy; <span id="year"></span> Query Crusaders. All rights reserved.</p>
                </footer>
            </div>

            <script>
                document.getElementById('year').textContent = new Date().getFullYear();

                // --- Configuration ---
                // *** REPLACE 'YOUR_TITLE_ID' with your actual PlayFab Title ID ***
                const playfabTitleId = "19F830";
                // *** Use Xsolla as the provider ***
                const defaultProviderName = "Xsolla";
                // Use the purchase initiation Cloud Script function name
                const cloudScriptFunctionName = "initiateWebPurchase";
                // --- End Configuration ---

                function showLoading(message = 'Processing purchase...') {
                    hideLoading();
                    const overlay = document.createElement('div');
                    overlay.id = 'loading-overlay';
                    overlay.textContent = message;
                    document.body.appendChild(overlay);
                }

                function hideLoading() {
                    const loadingOverlay = document.getElementById('loading-overlay');
                    if (loadingOverlay) loadingOverlay.remove();
                }

                async function handlePurchase(itemId, price, currencyCode) {
                    console.log(`Attempting purchase for item: ${itemId}, Price: ${price}, Currency: ${currencyCode}`);
                    const urlParams = new URLSearchParams(window.location.search);
                    const playerId = urlParams.get('playerId');
                    const sessionTicket = urlParams.get('sessionTicket');

                    if (!playerId || !sessionTicket || !playfabTitleId || playfabTitleId === "YOUR_TITLE_ID") {
                        alert("Error: Missing player data or configuration. Please restart from the game.");
                        console.error("Missing playerId, sessionTicket, or playfabTitleId is not set.");
                        return;
                    }

                    console.log(`Player ID: ${playerId}, Item ID: ${itemId}, Provider: ${defaultProviderName}`);
                    const cloudScriptUrl = `https://${playfabTitleId}.playfabapi.com/Client/ExecuteCloudScript`;
                    const requestBody = {
                        FunctionName: cloudScriptFunctionName,
                        FunctionParameter: {
                            playerId: playerId,
                            itemId: itemId,
                            currencyCode: currencyCode,
                            providerName: defaultProviderName
                        },
                        GeneratePlayStreamEvent: true
                    };

                    showLoading('Contacting server...');
                    try {
                        const response = await fetch(cloudScriptUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json', 'X-Authentication': sessionTicket },
                            body: JSON.stringify(requestBody)
                        });

                        if (!response.ok) {
                            const errorData = await response.json().catch(() => null);
                            console.error("Cloud Script HTTP error:", response.status, errorData);
                            alert(`Error initiating purchase: ${errorData?.errorMessage || `Server error ${response.status}`}`);
                            hideLoading(); return;
                        }

                        const result = await response.json();
                        console.log("Cloud Script Response:", result);

                        if (result.code === 200 && result.data?.FunctionResult?.success && result.data.FunctionResult.paymentProviderRedirectUrl) {
                            console.log("Cloud Script successful, redirecting to Xsolla...");
                            showLoading('Redirecting to payment provider...');
                            window.location.href = result.data.FunctionResult.paymentProviderRedirectUrl;
                        } else {
                            console.error("Error from Cloud Script function:", result.data?.FunctionResult?.error || result);
                            alert(`Purchase failed: ${result.data?.FunctionResult?.errorMessage || result.errorMessage || 'Unknown server error.'}`);
                            hideLoading();
                        }
                    } catch (error) {
                        console.error("Fetch error:", error);
                        alert("Network error during purchase initiation. Please try again.");
                        hideLoading();
                    }
                }
            </script>
        </body>
        </html>
        